@inherits LayoutComponentBase
@inject IAuthStateProvider AuthStateProvider
@inject IAuthenticationClient AuthClient
@inject NavigationManager Navigation

<div class="min-h-screen bg-gray-50 dark:bg-gray-900">
    <Navbar />
    
    <div class="pt-16">
        <main class="p-4 md:ml-64">
            <Sidebar />
            <div class="p-4">
                @Body
            </div>
        </main>
    </div>
</div>

@code {
    private bool _isAuthenticated;

    protected override void OnInitialized()
    {
        _isAuthenticated = AuthStateProvider.CurrentState.IsAuthenticated;
        AuthStateProvider.OnStateChanged += HandleAuthStateChanged;
    }

    private void HandleAuthStateChanged()
    {
        _isAuthenticated = AuthStateProvider.CurrentState.IsAuthenticated;
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        AuthStateProvider.OnStateChanged -= HandleAuthStateChanged;
    }
}
